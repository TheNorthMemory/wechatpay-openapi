post:
  x-last-updated-at: 2025.12.05
  x-role:
    - 服务商
  tags:
    - 自动还款
  summary: H5预签约自动还款协议
  description: 服务商调用本接口预先指定签约信息，进行预签约。在完成预签约后，服务商会得到对应的预签约码（presign_token）。服务商H5再携带预签约码参数拉起微信客户端的签约页面，让用户完成签约。签约完成后，将返回服务商H5。若用户同意本次流程，则微信支付会通过服务商指定的回调地址通知签约结果；若用户未同意或者流程执行失败，则不通知签约结果。在发起签约后，服务商签约协议号不能再重复使用，包括签约失败的协议、签约成功后解约的协议及签约成功生效中的协议。服务商可通过查询协议接口确认服务商签约协议号是否已经使用。注意：服务商获取到的预签约码有效期为10分钟。10分钟后，预签约码失效。此时，如果再携带预签约ID跳转到微信客户端进行签约，则将报错。
  parameters:
    - $ref: '../../../../definitions/Parameters.yaml#/HTTP_WECHATPAY_SERIAL'
    - name: _
      in: body
      required: true
      schema:
        type: object
        required:
          - appid
          - plan_id
          - out_contract_code
          - display_name
          - contract_notify_url
          - repayment_day
          - repayment_amount_limit
          - real_identity
        properties:
          appid:
            type: string
            description: 商户AppID
            example: wxd678efh567hg6787
          plan_id:
            type: string
            description: 模板ID
            example: '123'
          out_contract_code:
            type: string
            description: 服务商签约协议号
            example: '100001256'
          display_name:
            type: string
            description: 用户展示名称
            example: '*明'
          contract_notify_url:
            type: string
            description: 签约结果通知地址
            example: https://pay.weixin.qq.com
          repayment_day:
            type: integer
            description: 还款日
            example: 1
          repayment_amount_limit:
            type: string
            description: 还款金额上限
            example: '10000'
          sub_mchid:
            type: string
            description: 子商户号
            example: '1000000109'
          sub_appid:
            type: string
            description: 子商户AppID
            example: example_sub_appid
          real_identity:
            type: object
            description: 用户实名信息
            required:
              - identity_type
              - identity_id
              - real_name
            properties:
              identity_type:
                type: string
                description: 实名验证类型
                example: REAL_IDENTITY_TYPE_INVALID
                enum:
                  - REAL_IDENTITY_TYPE_INVALID
                  - REAL_IDENTITY_TYPE_ID_CARD
              identity_id:
                type: string
                format: base64
                description: 自然人证件号码
                example: 1axtI9EZUr0343c89xQznxau+cRWPKP4YhVAoj==
              real_name:
                type: string
                format: base64
                description: 自然人姓名
                example: OEimkKuua8igpd+0YDgqF2Z61leeGD7x87j3Ph==
          trade_info:
            type: object
            description: 交易信息
            required:
              - out_trade_no
              - deduct_amount
            properties:
              out_trade_no:
                type: string
                description: 商户侧交易单号
                example: '1217752501201407033233368018'
              deduct_amount:
                type: integer
                description: 还款金额
                example: 10000
              description:
                type: string
                description: 产品描述
                example: 信贷还款
              attach:
                type: string
                description: 商户数据包
                example: 备注信息
              notify_url:
                type: string
                description: 商户回调地址
                example: https://www.test.com
          jump_info:
            type: object
            description: 跳转控制信息
            properties:
              jump_appid:
                type: string
                description: 签约完后要跳转到的应用AppID
                example: example_jump_appid
  responses:
    '200':
      schema:
        type: object
        required:
          - redirect_url
        properties:
          redirect_url:
            type: string
            description: 拉起微信支付签约页的URL
            example: https://payapp.weixin.qq.com/xxx?presign_token=wx12334
