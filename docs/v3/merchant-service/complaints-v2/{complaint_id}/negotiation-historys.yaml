get:
  x-last-updated-at: 2025.08.28
  x-role:
    - 服务商
    - 渠道商
    - 从业机构
  tags:
    - 风险合规∙消费者投诉
  summary: 查询投诉协商历史API
  description: 商户可通过调用此接口，查询指定投诉的用户商户协商历史，以分页输出查询结果，方便商户根据处理历史来制定后续处理方案。[官方文档](https://pay.weixin.qq.com/docs/partner/apis/consumer-complaint/complaints/query-negotiation-history-v2.html) [官方文档](https://pay.weixin.qq.com/wiki/doc/apiv3_partner/apis/chapter10_2_12.shtml)
  parameters:
    - name: complaint_id
      type: string
      in: path
      description: 投诉单号
      required: true
      example: '200201820200101080076610000'
    - name: limit
      type: integer
      in: query
      description: 分页大小
      example: 50
    - name: offset
      type: integer
      in: query
      description: 分页开始位置
      example: 10
  responses:
    '200':
      schema:
        type: object
        required:
          - limit
          - offset
        properties:
          data:
            type: array
            description: 投诉协商历史
            items:
              type: object
              required:
                - log_id
                - operator
                - operate_time
                - operate_type
              properties:
                complaint_media_list:
                  type: object
                  description: 操作资料列表
                  properties:
                    media_type:
                      type: string
                      description: 媒体文件业务类型
                      example: USER_COMPLAINT_IMAGE
                      enum:
                        - USER_COMPLAINT_IMAGE
                        - OPERATION_IMAGE
                    media_url:
                      type: array
                      items:
                        type: string
                        format: url
                        description: 媒体文件请求url
                        example: https://api.mch.weixin.qq.com/v3/merchant-service/images/xxxxx
                log_id:
                  type: string
                  description: 操作流水号
                  example: '300285320210322170000071077'
                operator:
                  type: string
                  description: 操作人
                  example: 投诉人
                operate_time:
                  type: string
                  format: rfc3339
                  description: 操作时间
                  example: '2015-05-20T13:29:35.120+08:00'
                operate_type:
                  type: string
                  description: 操作类型
                  example: USER_CREATE_COMPLAINT
                  enum:
                    - USER_CREATE_COMPLAINT #用户提交投诉
                    - USER_CONTINUE_COMPLAINT #用户继续投诉
                    - USER_RESPONSE #用户留言
                    - PLATFORM_RESPONSE #平台留言
                    - MERCHANT_RESPONSE #商户留言
                    - MERCHANT_CONFIRM_COMPLETE #商户申请结单
                    - USER_CREATE_COMPLAINT_SYSTEM_MESSAGE #用户提交投诉系统通知
                    - COMPLAINT_FULL_REFUNDED_SYSTEM_MESSAGE #投诉单发起全额退款系统通知
                    - USER_CONTINUE_COMPLAINT_SYSTEM_MESSAGE #用户继续投诉系统通知
                    - USER_REVOKE_COMPLAINT #用户主动撤诉（只存在于历史投诉单的协商历史中）
                    - USER_COMFIRM_COMPLAINT #用户确认投诉解决（只存在于历史投诉单的协商历史中）
                    - PLATFORM_HELP_APPLICATION #平台催办
                    - USER_APPLY_PLATFORM_HELP #用户申请平台协助
                    - MERCHANT_APPROVE_REFUND #商户同意退款申请
                    - MERCHANT_REFUSE_RERUND #商户拒绝退款申请, 此时操作内容里展示拒绝原因
                    - USER_SUBMIT_SATISFACTION #用户提交满意度调查结果,此时操作内容里会展示满意度分数
                    - SERVICE_ORDER_CANCEL #服务订单已取消
                    - SERVICE_ORDER_COMPLETE #服务订单已完成
                    - COMPLAINT_PARTIAL_REFUNDED_SYSTEM_MESSAGE #投诉单发起部分退款系统通知
                    - COMPLAINT_REFUND_RECEIVED_SYSTEM_MESSAGE #投诉单退款到账系统通知
                    - COMPLAINT_ENTRUSTED_REFUND_SYSTEM_MESSAGE #投诉单受托退款系统通知
                    - USER_APPLY_PLATFORM_SERVICE #用户申请平台协助
                    - USER_CANCEL_PLATFORM_SERVICE #用户取消平台协助
                    - PLATFORM_SERVICE_FINISHED #客服结束平台协助
                    - USER_CLICK_RESPONSE #用户因点击产生留言
                operate_details:
                  type: string
                  description: 操作内容
                  example: 已与用户电话沟通解决
                image_list:
                  type: array
                  items:
                    type: string
                    format: url
                    description: 图片凭证
                    example: https://qpic.cn/xxx
                user_appy_platform_service_reason:
                  type: string
                  description: 用户申请平台协助原因
                  example: 商家响应不及时
                user_appy_platform_service_reason_description:
                  type: string
                  description: 用户申请平台协助原因描述
                  example: 一周前就提交咨询了，到现在商家还没理我
                normal_message:
                  type: object
                  description: 普通消息内容
                  properties:
                    blocks:
                      type: array
                      description: 消息内容
                      items:
                        type: object
                        properties:
                          type:
                            type: string
                            description: 消息块类型
                            example: TEXT
                            enum:
                              - TEXT
                              - IMAGE
                              - LINK
                              - FAQ_LIST
                              - BUTTON
                              - BUTTON_GROUP
                          text:
                            type: object
                            description: 文本
                            properties:
                              text:
                                type: string
                                description: 文本
                                example: example_text
                              color:
                                type: string
                                description: 文本颜色
                                example: DEFAULT
                                enum:
                                  - DEFAULT
                                  - SECONDARY
                              is_bold:
                                type: boolean
                                description: 是否粗体
                          image:
                            type: object
                            description: 图片
                            properties:
                              media_id:
                                type: string
                                format: MediaId
                                description: 媒体ID
                                example: example_media_id
                              image_style_type:
                                type: string
                                description: 图片样式类型
                                example: IMAGE_STYLE_TYPE_NARROW
                                enum:
                                  - IMAGE_STYLE_TYPE_NARROW
                                  - IMAGE_STYLE_TYPE_WIDE
                          link:
                            type: object
                            description: 链接
                            properties:
                              text:
                                type: string
                                description: 文本
                                example: example_text
                              action:
                                type: object
                                description: 动作
                                properties:
                                  action_type:
                                    type: string
                                    description: 动作类型
                                    example: ACTION_TYPE_SEND_MESSAGE
                                    enum:
                                      - ACTION_TYPE_SEND_MESSAGE
                                      - ACTION_TYPE_JUMP_URL
                                      - ACTION_TYPE_JUMP_MINI_PROGRAM
                                  jump_url:
                                    type: string
                                    description: 跳转链接
                                    example: example_jump_url
                                  mini_program_jump_info:
                                    type: object
                                    description: 跳转小程序信息
                                    required:
                                      - appid
                                      - path
                                      - text
                                    properties:
                                      appid:
                                        type: string
                                        description: 跳转小程序APPID
                                        example: example_appid
                                      path:
                                        type: string
                                        description: 跳转小程序页面PATH
                                        example: example_path
                                      text:
                                        type: string
                                        description: 跳转小程序页面名称
                                        example: example_text
                                  message_info:
                                    type: object
                                    description: 回复消息内容
                                    required:
                                      - content
                                    properties:
                                      content:
                                        type: string
                                        description: 回复的消息内容
                                        example: example_content
                                      custom_data:
                                        type: string
                                        description: 自定义透传字段
                                        example: example_custom_data
                                  action_id:
                                    type: string
                                    description: 动作id
                                    example: example_action_id
                              invalid_info:
                                type: object
                                description: 失效配置
                                properties:
                                  expired_time:
                                    type: string
                                    format: rfc3339
                                    description: 过期时间
                                    example: '2015-05-20T13:29:35+08:00'
                                  multi_clickable:
                                    type: boolean
                                    description: 是否可以多次点击
                          faq_list:
                            type: object
                            description: FAQ列表
                            properties:
                              faqs:
                                type: array
                                description: FAQ列表
                                items:
                                  type: object
                                  properties:
                                    faq_id:
                                      type: string
                                      description: faq的id
                                      example: example_faq_id
                                    faq_title:
                                      type: string
                                      description: faq内容
                                      example: example_faq_title
                                    action:
                                      type: object
                                      description: 动作
                                      properties:
                                        action_type:
                                          type: string
                                          description: 动作类型
                                          example: ACTION_TYPE_SEND_MESSAGE
                                          enum:
                                            - ACTION_TYPE_SEND_MESSAGE
                                            - ACTION_TYPE_JUMP_URL
                                            - ACTION_TYPE_JUMP_MINI_PROGRAM
                                        jump_url:
                                          type: string
                                          description: 跳转链接
                                          example: example_jump_url
                                        mini_program_jump_info:
                                          type: object
                                          description: 跳转小程序信息
                                          required:
                                            - appid
                                            - path
                                            - text
                                          properties:
                                            appid:
                                              type: string
                                              description: 跳转小程序APPID
                                              example: example_appid
                                            path:
                                              type: string
                                              description: 跳转小程序页面PATH
                                              example: example_path
                                            text:
                                              type: string
                                              description: 跳转小程序页面名称
                                              example: example_text
                                        message_info:
                                          type: object
                                          description: 回复消息内容
                                          required:
                                            - content
                                          properties:
                                            content:
                                              type: string
                                              description: 回复的消息内容
                                              example: example_content
                                            custom_data:
                                              type: string
                                              description: 自定义透传字段
                                              example: example_custom_data
                                        action_id:
                                          type: string
                                          description: 动作id
                                          example: example_action_id
                          button:
                            type: object
                            description: 按钮
                            properties:
                              text:
                                type: string
                                description: 文本
                                example: example_text
                              action:
                                type: object
                                description: 动作
                                properties:
                                  action_type:
                                    type: string
                                    description: 动作类型
                                    example: ACTION_TYPE_SEND_MESSAGE
                                    enum:
                                      - ACTION_TYPE_SEND_MESSAGE
                                      - ACTION_TYPE_JUMP_URL
                                      - ACTION_TYPE_JUMP_MINI_PROGRAM
                                  jump_url:
                                    type: string
                                    description: 跳转链接
                                    example: example_jump_url
                                  mini_program_jump_info:
                                    type: object
                                    description: 跳转小程序信息
                                    required:
                                      - appid
                                      - path
                                      - text
                                    properties:
                                      appid:
                                        type: string
                                        description: 跳转小程序APPID
                                        example: example_appid
                                      path:
                                        type: string
                                        description: 跳转小程序页面PATH
                                        example: example_path
                                      text:
                                        type: string
                                        description: 跳转小程序页面名称
                                        example: example_text
                                  message_info:
                                    type: object
                                    description: 回复消息内容
                                    required:
                                      - content
                                    properties:
                                      content:
                                        type: string
                                        description: 回复的消息内容
                                        example: example_content
                                      custom_data:
                                        type: string
                                        description: 自定义透传字段
                                        example: example_custom_data
                                  action_id:
                                    type: string
                                    description: 动作id
                                    example: example_action_id
                              invalid_info:
                                type: object
                                description: 失效配置
                                properties:
                                  expired_time:
                                    type: string
                                    format: rfc3339
                                    description: 过期时间
                                    example: '2015-05-20T13:29:35+08:00'
                                  multi_clickable:
                                    type: boolean
                                    description: 是否可以多次点击
                          button_group:
                            type: object
                            description: 按钮组
                            properties:
                              buttons:
                                type: array
                                description: 按钮组
                                items:
                                  type: object
                                  properties:
                                    text:
                                      type: string
                                      description: 文本
                                      example: example_text
                                    action:
                                      type: object
                                      description: 动作
                                      properties:
                                        action_type:
                                          type: string
                                          description: 动作类型
                                          example: ACTION_TYPE_SEND_MESSAGE
                                          enum:
                                            - ACTION_TYPE_SEND_MESSAGE
                                            - ACTION_TYPE_JUMP_URL
                                            - ACTION_TYPE_JUMP_MINI_PROGRAM
                                        jump_url:
                                          type: string
                                          description: 跳转链接
                                          example: example_jump_url
                                        mini_program_jump_info:
                                          type: object
                                          description: 跳转小程序信息
                                          required:
                                            - appid
                                            - path
                                            - text
                                          properties:
                                            appid:
                                              type: string
                                              description: 跳转小程序APPID
                                              example: example_appid
                                            path:
                                              type: string
                                              description: 跳转小程序页面PATH
                                              example: example_path
                                            text:
                                              type: string
                                              description: 跳转小程序页面名称
                                              example: example_text
                                        message_info:
                                          type: object
                                          description: 回复消息内容
                                          required:
                                            - content
                                          properties:
                                            content:
                                              type: string
                                              description: 回复的消息内容
                                              example: example_content
                                            custom_data:
                                              type: string
                                              description: 自定义透传字段
                                              example: example_custom_data
                                        action_id:
                                          type: string
                                          description: 动作id
                                          example: example_action_id
                                    invalid_info:
                                      type: object
                                      description: 失效配置
                                      properties:
                                        expired_time:
                                          type: string
                                          format: rfc3339
                                          description: 过期时间
                                          example: '2015-05-20T13:29:35+08:00'
                                        multi_clickable:
                                          type: boolean
                                          description: 是否可以多次点击
                              button_layout:
                                type: string
                                description: 按钮布局方式
                                example: LAYOUT_HORIZONTAL
                                enum:
                                  - LAYOUT_UNKNOWN
                                  - LAYOUT_HORIZONTAL
                                  - LAYOUT_VERTICAL
                              invalid_info:
                                type: object
                                description: 失效配置
                                properties:
                                  expired_time:
                                    type: string
                                    format: rfc3339
                                    description: 过期时间
                                    example: '2015-05-20T13:29:35+08:00'
                                  multi_clickable:
                                    type: boolean
                                    description: 是否可以多次点击
                    sender_identity:
                      type: string
                      description: 发送者身份类别
                      example: UNKNOWN
                      enum:
                        - UNKNOWN
                        - MANUAL
                        - MACHINE
                    custom_data:
                      type: string
                      description: 自定义透传信息
                      example: example_custom_data
                click_message:
                  type: object
                  description: 用户点击回复消息
                  properties:
                    message_content:
                      type: object
                      description: 回复的消息内容
                      example: example_message_content
                    action_id:
                      type: string
                      description: 动作id
                      example: example_action_id
                    clicked_log_id:
                      type: string
                      description: 被点击的操作流水号
                      example: example_clicked_log_id
          limit:
            type: integer
            description: 分页大小
          offset:
            type: integer
            description: 分页开始位置
            example: 50
          total_count:
            type: integer
            description: 投诉协商历史总条数
            example: 1000
