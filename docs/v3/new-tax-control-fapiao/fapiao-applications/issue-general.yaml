post:
  x-last-updated-at: 2025.09.03
  x-role:
    - 服务商
    - 渠道商
  tags:
    - 经营工具∙电子发票
  summary: 开具通用行业电子发票
  description: 商户完成收款后，调用本接口开具通用行业电子发票并插入微信用户的卡包。请求的交易信息必须真实存在。 注意：本接口成功返回仅代表开票请求已被受理，当开票完成时，微信支付会根据商户配置的回调地址进行回调通知，商户也可以通过【查询电子发票】接口获取开票结果及开票信息。
  parameters:
    - $ref: '../../../definitions/Parameters.yaml#/HTTP_WECHATPAY_SERIAL'
    - name: _
      in: body
      required: true
      schema:
        type: object
        required:
          - sub_mchid
          - fapiao_apply_id
          - buyer_information
          - fapiao_information
        properties:
          sub_mchid:
            type: string
            description: 子商户号
            example: '1900000109'
          fapiao_apply_id:
            type: string
            description: 发票申请单号
            example: '4200000444201910177461284488'
          buyer_information:
            type: object
            description: 购买方信息
            required:
              - type
              - name
            properties:
              type:
                type: string
                description: 购买方类型
                example: ORGANIZATION
                enum:
                  - INDIVIDUAL
                  - ORGANIZATION
              name:
                type: string
                description: 名称
                example: 深圳市南山区测试企业
              taxpayer_id:
                type: string
                description: 纳税人识别号
                example: '202003261233701778'
              address:
                type: string
                description: 地址
                example: 深圳市南山区深南大道10000号
              telephone:
                type: string
                description: 电话
                example: '075512345678'
              bank_name:
                type: string
                description: 开户银行
                example: 测试银行
              bank_account:
                type: string
                description: 银行账号
                example: '62001234567890'
              phone:
                type: string
                format: base64
                description: 手机号
                example: pVd1HJ6zyvPedzGaV+X3qtmrq9bb9tPttdY+aQ6zB
              email:
                type: string
                format: base64
                description: 邮箱地址
                example: pVd1HJ6zyvPedzGaV+X3qtmrq9bb9tPttdY+aQ6zB
              amount:
                type: integer
                description: 订单金额
                example: 1000
              out_trade_no:
                type: string
                description: 商户订单号
                example: order_20200701_123456
              fapiao_bill_type:
                type: string
                description: 开具的发票类型
                example: COMM_FAPIAO
                enum:
                  - COMM_FAPIAO
                  - VAT_FAPIAO
              user_apply_message:
                type: string
                description: 留言信息
                example: 用户留言
          fapiao_information:
            type: object
            description: 需要开具的数电发票信息
            required:
              - fapiao_id
              - total_amount
              - need_list
              - items
              - billing_person_id
              - fapiao_bill_type
              - transaction_information
            properties:
              fapiao_id:
                type: string
                description: 商户发票单号
                example: '20200701123456'
              total_amount:
                type: integer
                description: 总价税合计
                example: 382895
              items:
                type: array
                description: 发票行信息
                items:
                  type: object
                  required:
                    - tax_code
                    - goods_name
                    - total_amount
                    - tax_rate
                    - discount
                  properties:
                    tax_code:
                      type: string
                      description: 税局侧规定的货物或应税劳务、服务税收分类编码
                      example: '3010101020203000000'
                    goods_name:
                      type: string
                      description: 货物或应税劳务、服务名称
                      example: 出租汽车客运服务
                    specification:
                      type: string
                      description: 规格型号
                      example: A4
                    unit:
                      type: string
                      description: 单位
                      example: 次
                    quantity:
                      type: integer
                      description: 数量
                      example: 100000000
                    total_amount:
                      type: integer
                      description: 单行金额合计
                      example: 429900
                    tax_rate:
                      type: number
                      description: 税率
                      example: 1300
                    discount:
                      type: boolean
                      description: 是否折扣行
                    preferential_policy_code:
                      type: integer
                      description: 优惠政策标识
                      example: 1
                      enum:
                        - 1  #简易征收
                        - 2  #稀土产品
                        - 3  #免税
                        - 4  #不征税
                        - 5  #先征后退
                        - 6  #100%先征后退
                        - 7  #50%先征后退
                        - 8  #按3%简易征收
                        - 9  #按5%简易征收
                        - 10 #按5%简易征收减按1.5%计征
                        - 11 #即征即退30%
                        - 12 #即征即退50%
                        - 13 #即征即退70%
                        - 14 #即征即退100%
                        - 15 #超税负3%即征即退
                        - 16 #超税负8%即征即退
                        - 17 #超税负12%即征即退
                        - 18 #超税负6%即征即退
              export_business_policy_code:
                type: integer
                description: 出口业务适用政策代码
                example: 1
                enum:
                  - 1 #退税政策
                  - 2 #免税政策
                  - 3 #征税政策
              vat_refund_levy_code:
                type: integer
                description: 增值税即征即退代码
                example: 1
                enum:
                  - 1  #软件产品
                  - 2  #资源综合利用产品
                  - 3  #管道运输服务
                  - 4  #有形动产融资租赁服务
                  - 5  #有形动产融资性售后回租服务
                  - 6  #新型墙体材料
                  - 7  #风力发电产品
                  - 8  #光伏发电产品
                  - 9  #动漫软件产品
                  - 10 #飞机维修劳务
                  - 11 #黄金
                  - 12 #铂金
              billing_person_id:
                type: string
                description: 开票人ID
                example: '128279891283'
              billing_person:
                type: string
                description: 开票人名称
                example: example_billing_person
              fapiao_bill_type:
                type: string
                description: 发票类型
                example: COMM_FAPIAO
                enum:
                  - COMM_FAPIAO
                  - VAT_FAPIAO
              transaction_information:
                type: array
                description: 交易信息
                items:
                  type: object
                  required:
                    - pay_channel
                    - transaction_id
                    - amount
                  properties:
                    pay_channel:
                      type: string
                      description: 支付渠道
                      example: WECHAT_PAY
                      enum:
                        - WECHAT_PAY
                    transaction_id:
                      type: string
                      description: 支付订单号
                      example: '4200000008202508080512076713'
                    out_trade_no:
                      type: string
                      description: 支付商户订单号
                      example: order_20200701_123456
                    amount:
                      type: integer
                      description: 交易金额
                      example: 382895
              remark:
                type: string
                description: 发票备注
                example: 备注
  responses:
    '202':
      schema: {}
